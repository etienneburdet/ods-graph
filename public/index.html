<!DOCTYPE html>
<html>

<head>
  <base href="/">

  <title>ODS Widgets Sandbox</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://opendatasoft.github.io/ods-widgets/dist/ods-widgets.css">
</head>

<body>

  <div class="ng-cloak" ng-app="ods-widgets">

    <ods-dataset-context
        context="cocktails"
        cocktails-dataset="cocktails"
        cocktails-domain="https://eburdet.opendatasoft.com/"
        ng-init="cardHeight = 64; cardWidth = 128; gutter = {x: 64, y:16}; canvasHeight = []">
      <div ods-results="items"
        ods-results-context="cocktails"
        ng-repeat="cocktail in items"
        ng-init="canvasHeight[$index] = (cocktail.fields.ingredients|fromjson).length * (cardHeight + 2 * gutter.y)">
        <svg width="960px" height="{{canvasHeight[$index]}}px">
          <foreignObject x="{{ gutter.x }}px"
            y="{{ (canvasHeight[$index] - cardHeight) / 2}}px"
            height="{{ cardHeight + 2 * gutter.y }}px"
            width="{{ cardWidth + 2 * gutter.x }}px">
            <div class="card">
              {{ cocktail.fields.name }}
            </div>
          </foreignObject>
          <foreignObject ng-repeat-start="ingredient in cocktail.fields.ingredients|fromjson"
            x="{{3 * gutter.x + cardWidth}}px"
            y="{{ gutter.y + $index * (2 * gutter.y + cardHeight)}}px"
            height="{{ cardHeight + 2 * gutter.y }}px"
            width="{{ cardWidth + 2 * gutter.x }}px">
              <div class="card">{{ ingredient.name }}</div>
          </foreignObject>
          <line x1="{{ gutter.x + cardWidth }}px" y1="{{ (canvasHeight[$index] - cardHeight) / 2 + 0.5 * cardHeight}}px"
            x2="{{3 * gutter.x + cardWidth }}px" y2="{{ gutter.y + $index * (2 * gutter.y + cardHeight) + 0.5 * cardHeight}}px"
            stroke="black" stroke-width="2px"></line>
          <line x1="{{3 * gutter.x + 2 * cardWidth}}px" y1="{{ gutter.y + $index * (2 * gutter.y + cardHeight) + 0.5 * cardHeight}}px"
            x2="{{5 * gutter.x + 2 * cardWidth}}px" y2="{{ gutter.y + $index * (2 * gutter.y + cardHeight) + 0.5 * cardHeight}}px"
            stroke="black" stroke-width="2px"></line>
          <foreignObject x="{{5 * gutter.x + 2 * cardWidth}}px"
            y="{{ gutter.y + $index * (2 * gutter.y + cardHeight)}}px"
            height="{{ cardHeight + 2 * gutter.y }}px"
            width="{{ cardWidth + 2 * gutter.x }}px"
            ng-repeat-end>
              <div class="card">{{ ingredient.dose }}</div>
          </foreignObject>
        </svg>
      </div>

    </ods-dataset-context>
    <!-- <svg width="400px" height="{{item.subitems.length * 190}}px">
    <line ng-repeat-start="subitem in item.subitems" x1="0" y1="{{(item.subitems.length * 190)/2}}px" x2="60px" y2="{{ 50 + 190 * $index}}px" stroke="black" stroke-width="2px"></line>
    <foreignObject  x="60px" y="{{ 20 + $index * 190 }}px" height="170px" width="400px" ng-repeat-end>
        <div class="card">
            {{ subitem }}
        </div>
    </foreignObject>
</svg> -->
  </div>

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-sanitize.min.js"></script>
  <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/i18n/angular-locale_fr-fr.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/locale/fr.js"></script> -->
  <script type="text/javascript" src="//opendatasoft.github.io/ods-widgets/dist/ods-widgets.js"></script>

  <!-- <script type="text/javascript">
    var ods = angular.module('ods-widgets');
    ods.run(function(gettextCatalog) {
      gettextCatalog.setStrings('fr', {
        'Clear all': 'Tout effacer',
        'More': 'Voir plus',
        'Less': 'Voir moins',
        'Download image': 'Télécharger l\'image'
      });
      gettextCatalog.setCurrentLanguage('fr');
    });
  </script>

  <script type="text/javascript">
    angular.module('ods-widgets').config(function($locationProvider) {
      $locationProvider.html5Mode(true);
    });
  </script>

  <script type="text/javascript">
    angular.module('ods-widgets').config(function(ODSWidgetsConfigProvider) {
      ODSWidgetsConfigProvider.setConfig({
          "basemaps": [
            {
               "label": "Stamen",
               "provider": "stamen.toner"
            },
            {
              "url": "https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png",
              "strictTMS": false,
              "provider": "custom",
              "label": "Thunderforest",
              "id": "land"
            }
          ]
          });
    });
  </script> -->

</body>

</html>
